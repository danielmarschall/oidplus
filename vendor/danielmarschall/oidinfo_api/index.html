<html>

<head>
<title>oid-info.com API for PHP</title>
<style>
code, pre {
	color:blue;
}
pre.cmd {
	background-color:#BBBBBB;
}
.attention {
	color:red;
}
</style>
</head>

<body>

<h1>oid-info.com API for PHP</h1>

<p><i>24 November 2021</i></p>

<h2>Introduction</h2>

<p><a href="http://oid-info.com/">oid-info.com</a> is a public repository for Object Identifiers (OIDs). This API is available in PHP and can be used in web-interfaces (Apache module, cgi-bin, etc.) but can also be used in command line tools written in PHP (on Linux with shebang <code>#!/usr/bin/php</code>) .</p>

<p>The majority of the functions provided by this API helps developers in creating XML files which can be uploaded to the OID repository to add multiple OIDs, but the API also contains other helpful utilities related to OIDs, UUIDs and the OID repository in general. The XML generation can be useful for Registration Authorities (RAs) that want to deliver their assignments to oid-info.com , but also for people who want to support the OID repository by adding OIDs from public sources. The XML files generated by these API functions are conform with the <a href="http://www.oid-info.com/oid.xsd">XML schema of oid-info.com</a> and can be uploaded <a href="http://www.oid-info.com/submit.htm">here</a> - you will also find more information about the XML submission at these pages.</p>

<p>An example of a XML generation code can be found here: <a href="oidinfo_example.phps">oidinfo_example.phps</a></p>

<p>The API is licensed under the terms of the <a href="https://www.apache.org/licenses/LICENSE-2.0">Apache 2.0 License</a> and was written by <a href="http://www.daniel-marschall.de/">Daniel Marschall</a>.</p>

<h2>Download</h2>

<p><a href="https://www.viathinksoft.com/projects/oidinfo_api">Download the current version of the API here</a> / <a href="https://svn.viathinksoft.com/cgi-bin/viewvc.cgi/oidinfo_api/">Browse SVN repository</a></p>

<p>Browse the source code online:</p>

<ul>
	<li><a href="oid_illegality_rules">oid_illegality_rules</a></li>
	<li><a href="oidinfo_api.inc.phps">oidinfo_api.inc.phps</a></li>
	<li><a href="oidinfo_test.phps">oidinfo_test.phps</a> (optional)</li>
	<li><a href="oidinfo_example.phps">oidinfo_example.phps</a> (optional)</li>
	<li><a href="oid_utils.inc.phps">oid_utils.inc.phps</a> (dependent unit)</li>
	<li><a href="uuid_utils.inc.phps">uuid_utils.inc.phps</a> (dependent unit)</li>
	<li><a href="mac_utils.inc.phps">mac_utils.inc.phps</a> (dependent unit)</li>
	<li><a href="xml_utils.inc.phps">xml_utils.inc.phps</a> (dependent unit)</li>
	<li>Example for a simple ping provider (<a href="#part6">see part 6</a>): <a href="csv_lookup_server_example/">CSV Lookup Server</a></li>
</ul>

<h2>Table of Contents</h1>

<ul>
	<li><a href="#part1">Part 1: "Ping API" / "Verbose Ping Provider" for checking if OIDs are available or allowed to create</a></li>
	<li><a href="#part2">Part 2: Syntax checking</a></li>
	<li><a href="#part3">Part 3: XML file creation</a></li>
	<li><a href="#part4">Part 4: Offline check if OIDs are illegal</a></li>
	<li><a href="#part5">Part 5: Misc functions</a></li>
	<li><a href="#part6">Part 6: Simple Ping Providers</a></li>
</ul>

<h2>Class <code>OIDInfoAPI</code></h2>

<p><i>Note: Not every throwable Exception (they are all of type <code>OIDInfoException</code>) is described in the method descriptions.</i></p>

<h3><a name="part1">Part 1: "Ping API" / "Verbose Ping Provider" for checking if OIDs are available or allowed to create</h3>

<h4>Online check functions</h4>

<p><i>Note: These 4 functions include the <code>strictCheckSyntax()</code> check (see <a href="#part2">Part 2: Syntax checking</a>).</i></p>

<pre class="cmd">public function checkOnlineExists($oid)</pre>
	<p>An online check will be performed, to check if <code>$oid</code> <i>exists</i>. "Exist" means, the OID was added to the repository. Exist does not mean that the OID is also validated by the OID repository admin (i.e. available through the web interface).</p>
	<p>You can use the function <code>oidExisting</code> which uses the online-check (verbose ping provider) and the simple-ping-provider, if available, in combination.</p>
<pre class="cmd">public function checkOnlineAvailable($oid)</pre>
	<p>An online check will be performed, to check if <code>$oid</code> is <i>available</i>. "Available" means, the OID was added to the repository and is validated by the OID repository admin.</p>
<pre class="cmd">public function checkOnlineAllowed($oid)</pre>
	<p>An online check will be performed, to check if <code>$oid</code> is <i>allowed</i>. "Allowed" means, that the OID repository allows the creation of this OID. This is the case for OIDs which are not created in a frozen or leaf arc of the OID tree and are not known as illegal.</p>
	<p><font class="attention">Attention!</font> "Allowed" will also be <code>true</code> if the OID already exists in the OID repository.</p>
	<p><font class="attention">Attention!</font> Before using this function, you should verify that <code>$oid</code> is not listed in the local blacklist (please see <a href="#part4">Part 4: Offline check if OIDs are illegal</a>), by using <code>illegalOID($oid)</code>, because this low level function does not include this check by design.</p>
<pre class="cmd">public function checkOnlineMayCreate($oid)</pre>
	<p>An online check will be performed, to check if <code>$oid</code> may be <i>created</i>. This means that the OID is <i>allowed</i> (<code>checkOnlineAllowed</code>) and does not <i>exist</i> (<code>!checkOnlineExists</code>).</p>
<!--	<p><font class="attention">Attention!</font> This check will NOT include a check against the local blacklist of illegal OIDs (please see <a href="#part4">Part 4: Offline check if OIDs are illegal</a>). This step needs to be done separately.</p> -->
	<p><font class="attention">Attention!</font> Before using this function, you should verify that <code>$oid</code> is not listed in the local blacklist (please see <a href="#part4">Part 4: Offline check if OIDs are illegal</a>), by using <code>illegalOID($oid)</code>, because this low level function does not include this check by design. It is recommended to use <code>oidMayCreate()</code> instead.</p>

<h4>Caching</h4>
<pre class="cmd">pingCacheMaxAge = 3600</pre>
	<p>The results of <code>checkOnlineExists</code>, <code>checkOnlineAvailable</code>, <code>checkOnlineAllowed</code> and <code>checkOnlineMayCreate</code> are cached to reduce the amount of web traffic, which also increases the performance. The variable <code>pingCacheMaxAge</code> contains the maxiumum amount of seconds before the cache entry will be renewed.
	The cache will be automatically cleared if the function <code>clearPingCache</code> is called, or if the PHP script session terminates.</p>
	<p>The default value is 3600 seconds, which is 1 hour. If you are using the OIDInfo-API in a long-term process (e.g. a daemon or crawler service), you should probably modify the <code>pingCacheMaxAge</code> setting.
	<p>If you want to make sure that the cache is never used, please set <code>pingCacheMaxAge = -1</code>. Please note, that the cache is still maintained (extended and updated).</p>
	<p>If you do not want that the cache entries expire, you can use the <a href="http://php.net/manual/en/math.constants.php">PHP constant</a> INF: <code>pingCacheMaxAge = INF</code>.</p>
<pre class="cmd">public function clearPingCache()</pre>
	<p>This function clears the ping cache. This will also reduce the amount of currently used memory.</p>

<h4>Configuration of the verbose ping provider</h4>

<p><i>The "Verbose Ping Provider" is a HTTP(S) webservice which tells wheather an OID exists at oid-info.com, and if it may be created.</i></p>

<p>The webservice must return following content:</p>

<pre>
         First digit of the ping result
         "-" = error
         "0" = OID does not exist
         "1" = OID does exist, but is not approved yet
         "2" = OID does exist and is accessible

         Second digit of the ping result
         "-" = error
         "0" = The OID may not be created
         "1" = OID is not an illegal OID, and none of its ascendant is a leaf and its parent OID is not frozen
</pre>

<pre class="cmd">$verbosePingProviders = array('https://misc.daniel-marschall.de/oid-repository/ping_oid.php?oid={OID}');</pre>
<p>The URL(s) of the verbose ping provider(s). The string <code>{OID}</code> will be replaced by the OID in dot-notation. Usually, you do not need to edit this configuration.</p>

<h3><a name="part2">Part 2: Syntax checking</h3>

<pre class="cmd">public static function strictCheckSyntax($oid)</pre>
	<p>Returns <code>true</code>, if the <code>$oid</code> has the correct syntax for usage in the XML files for the OID repository. This means:</p>
	<ul>
		<li>The syntax is a valid dot-notation</li>
		<li>The OID does not begin with a dot (this notation can be found in SNMP and OID+ systems)</li>
		<li>No arc contains a leading zero</li>
	</ul>
<pre class="cmd">public static function trySanitizeOID($oid)</pre>
	<p>Tries to repair <code>$oid</code> to make it comply with <code>strictCheckSyntax</code>. A leading dot as well as leading zeros will be removed. If the OID is still invalid, the function will return <code>false</code>, otherwise the sanitized OID as string.</p>

<h3><a name="part3">Part 3: XML file creation</h3>

<pre class="cmd">public function softCorrectEMail($email, $params)</pre>
	<p>This function tries to correct an invalid eMail address (probably obfuscated for anti spam purposes), e.g. "john[at]example[dot]com" will be corrected into "john@example.com" .</p>
	<p>If <code>$params['allow_illegal_email']</code> is <code>true</code>, and the email address is still invalid, an empty string will be returned.</p>
	<p>Otherwise, the function will return the email address which was fully, partially or not corrected.</p>
	<p><font class="attention">Attention!</font> You don't need to use this function if you create an XML file using <code>createXMLEntry</code>, since this step will be done automatically.</p>
<pre class="cmd">public function softCorrectPhone($phone, $params)</pre>
	<p>This function tries to corrects a phone number and remove invalid characters, like dashes or brackets.</p>
	<p><font class="attention">Attention!</font> You don't need to use this function if you create an XML file using <code>createXMLEntry</code>, since this step will be done automatically.</p>
<pre class="cmd">public function correctDesc($desc, $params, $ending_dot_policy=OIDInfoAPI::OIDINFO_CORRECT_DESC_OPTIONAL_ENDING_DOT, $enforce_xhtml_light=false)</pre>
	<p>This function tries to change the description to make it comply with the XML file.</p>
	<p>If <code>$params['allow_html']</code> is <code>true</code>, HTML tags will be allowed, otherwise they will be encoded.</p>
	<p>If <code>$params['tolerant_htmlentities']</code> is <code>true</code>, double encoded HTML entities like <code>&amp;amp;amp;</code> will be corrected.</p>
	<p>Also, this function will remove unnecessary phrasings like "OID for " at the beginning or ending of the description.</p>
	<p>Following constants are valid values for <code>$ending_dot_policy</code>:</p>
	<ul>
		<li><code>OIDInfoAPI::OIDINFO_CORRECT_DESC_OPTIONAL_ENDING_DOT = 0</code></li>
		<li><code>OIDInfoAPI::OIDINFO_CORRECT_DESC_ENFORCE_ENDING_DOT = 1</code> (A leading dot will be created if it is not available)</li>
		<li><code>OIDInfoAPI::OIDINFO_CORRECT_DESC_DISALLOW_ENDING_DOT = 2</code> (A leading dot will be removed from the text)</li>
	</ul>
	<p>If <code>$enforce_xhtml_light</code> is set to <code>true</code>, then tags which are not included in the <a href="http://www.oid-info.com/xhtml-light.xsd">XHTML Light specification</a> are removed, except if <code>$params['ignore_xhtml_light']</code> is <code>true</code>.</p>
	<p><font class="attention">Attention!</font> You don't need to use this function if you create an XML file using <code>createXMLEntry</code>, since this step will be done automatically.</p>
<pre class="cmd">public function xmlAddHeader($firstName, $lastName, $email)</pre>
	<p>Outputs the beginning of a XML file which can be created and submitted to oid-info.com</p>
<pre class="cmd">public function xmlAddFooter()</pre>
	<p>Returns the footer of the XML file.</p>
<pre class="cmd">public function createXMLEntry($oid, $elements, $params, $comment='')</pre>
	<p>Returns a <code>&lt;oid&gt;</code> entry for the XML file, with an optional comment <code>$comment</code> above the entry.</p>
	<p>Valid values of <code>$elements</code> and <code>$params</code> will be explained in the following sections.</p>

<h4>Valid values for <code>$params</code></h4>
<pre class="cmd">$params['allow_html']</pre>
	<p>Allows HTML in <code>&lt;description&gt;</code> and <code>&lt;information&gt;</code></p>
	<p>Default: <code>false</code></p>
<pre class="cmd">$params['allow_illegal_email']</pre>
	<p>Does not delete email addresses which could not be repaired with <code>softCorrectEMail</code>.</p>
	<p>This should stay enabled, because we don't know if the source used some kind of human-readable anti-spam technique instead of an actual wrong address.</p>
	<p>Default: <code>true</code></p>
<pre class="cmd">$params['soft_correct_behavior']</pre>
	<p>This defines the way ASN.1 identifiers (<code>$elements['synonymous-identifier']</code>) will be corrected in case they are illegal. Following modes are available:</p>
	<ul>
		<li><code>OIDInfoAPI::SOFT_CORRECT_BEHAVIOR_NONE</code> : The illegal identifier will be deleted.</li>
		<li><code>OIDInfoAPI::SOFT_CORRECT_BEHAVIOR_LOWERCASE_BEGINNING</code> : The beginning will be enforced to be lowercase.</li>
		<li><code>OIDInfoAPI::SOFT_CORRECT_BEHAVIOR_ALL_POSSIBLE</code> : All invalid characters will be removed, and the beginning will be enforced to be lowercase.</li>
	</ul>
	<p>Default: <code>OIDInfoAPI::SOFT_CORRECT_BEHAVIOR_NONE</code></p>
<pre class="cmd">$params['do_online_check']</pre>
	<p>Flag to disable this online check (<code>checkOnlineMayCreate($oid)</code>) to save traffic and runtime.</p>
	<p>Default: <code>false</code></p>
<pre class="cmd">$params['do_illegality_check']</pre>
	<p>Checks if the OID is illegal (<code>illegalOID($oid)</code>) before adding it to the XML</p>
	<p>Default: <code>true</code></p>
<pre class="cmd">$params['do_simpleping_check']</pre>
	<p>When a simple ping provider defined, the XML entry will not be added when one of the simple ping providers reports the OID as existing.</p>
	<p>Default: <code>true</code></p>
<pre class="cmd">$params['auto_extract_name']</pre>
	<p>If this is set, the <code>&lt;information&gt;</code> field will end with "Automatically extracted from ..."</p>
	<p>Default: ''</p>
<pre class="cmd">$params['auto_extract_url']</pre>
	<p>If this is set, the <code>&lt;information&gt;</code> field will end with "Automatically extracted from ..."</p>
	<p>Default: ''</p>
<pre class="cmd">$params['always_output_comment']</pre>
	<p>Also output comment if there was an error (e.g. OID already existing)</p>
	<p>Default: <code>false</code></p>
<pre class="cmd">$params['ignore_xhtml_light']</pre>
	<p>If set to <code>true</code>, tags which are not allowed in the <a href="http://www.oid-info.com/xhtml-light.xsd">XHTML Light specification</a> won't be excluded (fields: address, description and information).</p>

<h4>Valid values for <code>$elements</code></h4>

<pre>
$elements['synonymous-identifier'] = ''; // string or array
$elements['description'] = '';
$elements['information'] = '';

$elements['first-registrant']['first-name'] = '';
$elements['first-registrant']['last-name'] = '';
$elements['first-registrant']['address'] = '';
$elements['first-registrant']['email'] = '';
$elements['first-registrant']['phone'] = '';
$elements['first-registrant']['fax'] = '';
$elements['first-registrant']['creation-date'] = '';

$elements['current-registrant']['first-name'] = '';
$elements['current-registrant']['last-name'] = '';
$elements['current-registrant']['address'] = '';
$elements['current-registrant']['email'] = '';
$elements['current-registrant']['phone'] = '';
$elements['current-registrant']['fax'] = '';
$elements['current-registrant']['modification-date'] = '';
</pre>

<h3><a name="part4">Part 4: Offline check if OIDs are illegal</h3>

<p>With these functions, you can query if OIDs are listed in a blacklist, which is stored locally. The download package contains a default
<a href="oid_illegality_rules">illegality rule file</a> which contains known illegal OID arcs.</p>

</p>

<pre class="cmd">public function clearIllegalityRules()</pre>
	<p>Clears all illegality rules (please see below).</p>
<pre class="cmd">public function loadIllegalityRuleFile($file)</pre>
	<p>Loads a file which contains illegality rules (please see below).</p>
<pre class="cmd">public function addIllegalityRule($rule)</pre>
	<p>Adds an illegality rule (please see below).</p>
<pre class="cmd">public function illegalOID($oid, &$illegal_root='')</pre>
	<p>Returns <code>true</code>, if <code>$oid</code> is marked as illegal OID according to the illegality rules.</p>
	<p><code>$illegal_root</code> will contain the illegal beginning of the OID.</p>
	<p>Example: If 2.999.1 would be marked as illegal, and if <code>$oid</code> is 2.999.1.55, then <code>$illegal_root</code> will be 2.999.1</p>

<h4>Illegality rules</h4>

<p>Illegality rules define arcs or OIDs which are considered as illegal.</p>

<p>An illegality rule file has following syntax:</p>

<pre>[1.3.6.1.4.1.37476.3.1.5.1]

-- <i>comment</i>
<i>rule</i> --</i>comment</i>
<i>rule</i>
<i>rule</i></pre>

<p>where <a href="http://www.viathinksoft.de/documents/oid/oidplus/?action=show_oid&oid=.1.3.6.1.4.1.37476.3.1.5.1">1.3.6.1.4.1.37476.3.1.5.1</a> is the file format definition, and <i>rule</i> is an illegality rule (which can also be manually defined via <code>addIllegalityRule($rule)</code>) with following syntax:

<p><code>2.999.(11-).0</code> : the arc values 11 and below are illegal</p>
<p><code>2.999.(11+).0</code> : the arc values 11 and above are illegal</p>
<p><code>2.999.(1-5).0</code> : the arc values 1 to 5 are illegal</p>
<p><code>2.999.*.0</code> : * is equal to (0+)</p>

<h3><a name="part5">Part 5: Misc functions</h3>

<pre class="cmd">function __construct()</pre>
	<p>When the class is created and a file with the name "oid_illegality_rules" exist, this file will be processed with <code>loadIllegalityRuleFile</code>.</p>
<pre class="cmd">public static function getPublicURL($oid)</pre>
	<p>Returns the public URL to the OID registry, pointing to the information about <code>$oid</code>.</p>
<pre class="cmd">public function oidExisting($oid, $onlineCheck=true, $useSimplePingProvider=true)</pre>
	<p>Returns <code>true</code> if <code>$oid</code> is existing.</p>
	<p>If <code>$useSimplePingProvider</code> is <code>true</code>, the simple ping provider will be checked first.</p>
	<p>If the OID does not exist in the cache, or if no simple ping provider is loaded, or if <code>$useSimplePingProvider</code> is <code>false</code>, then an online check (<code>checkOnlineExists</code>) will be done if <code>$onlineCheck</code> is <code>true</code>.</p>
	<p>An Exception of type <code>OIDInfoException</code> will be thrown, if none of the both checks could be performed (e.g. no simple ping provider is defined and online check disabled).</p>
	<p>An Exception of type <code>OIDInfoException</code> will be thrown in case that <code>$oid</code> cannot be repaired with <code>trySanitizeOID($oid)</code></p>
<pre class="cmd">public function oidMayCreate($oid, $onlineCheck=true, $useSimplePingProvider=true, $illegalityCheck=true)</pre>
	<p>Returns <code>true</code> if <code>$oid</code> may be created.</p>
	<p>If <code>$illegalityCheck</code> is <code>true</code> and <code>illegalOID($oid)</code> results is <code>true</code>, then the function will immediately result in <code>false</code>.</p>
	<p>If <code>$useSimplePingProvider</code> is <code>true</code>, the simple ping provider will be checked first if the OID is already existing (which would result in <code>false</code>).</p>
	<p>If the OID does not exist in the cache, or if no simple ping provider is loaded, or if <code>$useSimplePingProvider</code> is <code>false</code>, then an online check (<code>checkOnlineMayCreate</code>) will be done if <code>$onlineCheck</code> is <code>true</code>.</p>
	<p>An Exception of type <code>OIDInfoException</code> will be thrown, if none of the both checks could be performed (e.g. no simple ping provider defined and online check disabled).</p>
	<p>An Exception of type <code>OIDInfoException</code> will be thrown in case that <code>$oid</code> cannot be repaired with <code>trySanitizeOID($oid)</code></p>

<h3><a name="part6">Part 6: Simple Ping Providers</h3>

<p><i>Following table shows the differnce between the Simple Ping Providers and the Verbose Ping Providers.</i></p>

<table border="1" width="60%" cellpadding="5" cellspacing="5">
<tr>
<td width="50%"><b>Simple Ping Provider (<a href="#part6">Part 6</a>)</b></td>
<td width="50%"><b>Verbose Ping Provider (<a href="#part1">Part 1</a>)</b></td>
</tr>

<tr>
<td>Uses Telnet protocol (usually port 49500)</td>
<td>Uses HTTP(s) protocol</td>
</tr>

<tr>
<td>Multiple queries per session/connection</td>
<td>Only 1 query per session (HTTP(s) request)</td>
</tr>

<tr>
<td>Multiple simple ping providers can be defined and hosted anywhere</td>
<td>Only the official ViaThinkSoft service can be used</td>
</tr>

<tr>
<td>Can provide any OID tree (e.g. your own RA's OIDs)</td>
<td>Provides information on all OIDs in oid-info.com</td>
</tr>

<tr>
<td>Only provides information if the OID exists at the given local database.</td>
<td>Provides information if the OID exists at oid-info.com, and if it may be created. Additionally, the information provided will make clear if the OID is active (i.e. activated by the verified by the administrator after submitting).</td>
</tr>

<tr>
<td>Very fast, especially if the service is located at the local host.</td>
<td>Rather slow</td>
</tr>

<tr>
<td>Usual scenario: You have an OID tree of your RA, and want to quickly check if a given OID is in that tree.</td>
<td>Usual scenario: You want to check if you may create an OID at oid-info.com, or if it is available there.</td>
</tr>

</table>

<pre class="cmd">public function addSimplePingProvider($addr)</pre>
	<p>Adds a simple ping provider.</p>
	<p>Possibility 1 (<code>OIDSimplePingProvider</code>): <code>$addr</code> is a hostname without protocol specification. The port is optional. If no port is specified, the port 49500 will be used. The connection will be only built up while the first query is sent!</p>
	<p>Possibility 2 (<code>CSVSimplePingProvider</code>):: <code>$addr</code> is a filename of a CSV file. A "virtual" simple ping provider will be created. The CSV will be read immediately, and will be re-read in every query, after the modification timestamp had changed.</p>
<pre class="cmd">public function removeSimplePingProvider($addr)</pre>
	<p>Removed a simple ping provider.</p>
<pre class="cmd">public function removeAllSimplePingProviders()</pre>
	<p>Removes all simple ping providers.</p>
<pre class="cmd">public function listSimplePingProviders()</pre>
	<p>List all simple ping providers.</p>
<pre class="cmd">public function simplePingProviderCheckOID($oid)</pre>
	<p>Checks if an OID is existing.</p>
	<p>The result is <code>true</code> when one of the providers returns "1".</p>
	<p>The result is <code>false</code> if all providers returned "0".</p>
	<p>The result is <code>null</code> no providers returned "1", and at least one provider failed to connect or returned something unexpected.</p>
	<p>Throws an Exception of type <code>OIDInfoException</code>, if no providers are in the list.</p>
<pre class="cmd">public function simplePingProviderAvailable()</pre>
	<p>Returns true, if at least one ping provider is added to the list.</p>



<!--
<h3><a name="part6">Part 6: CSV functions</h3>

<p>These functions are intended for special cooperations with oid-info.com, and are therefore not documented.</p>

<pre class="cmd">public function unloadCSVs()</pre>
<pre class="cmd">public function addCSVDump($file)</pre>
<pre class="cmd">public function defineLearningCSV($file)</pre>
<pre class="cmd">public function undefineLearningCSV($file)</pre>
<pre class="cmd">public function existsInCSV($oid)</pre>
<pre class="cmd">public function useSingleCSV($file, $mayModify=true, $create_cache=true)</pre>
-->

</body>

</html>

